<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nutrition Calculator</title>
  <!-- Bootstrap CDN link -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5">
  <h2 class="text-center mb-4">Nutrition Calculator</h2>

  <!-- Form to enter macronutrient details for a meal -->
  <form id="nutrition-form" class="row">
    <div class="mb-3 col-6 col-lg-3">
      <label for="carbs" class="form-label">Carbs (g) for 150g:</label>
      <input type="number" class="form-control" id="carbs" value="">
    </div>

    <div class="mb-3 col-6 col-lg-3">
      <label for="carbs-weight" class="form-label">Carbs Weight (g):</label>
      <input type="number" class="form-control" id="carbs-weight" value="150">
    </div>

    <div class="mb-3 col-6 col-lg-3">
      <label for="protein" class="form-label">Protein (g) for 150g:</label>
      <input type="number" class="form-control" id="protein" value="">
    </div>

    <div class="mb-3 col-6 col-lg-3">
      <label for="protein-weight" class="form-label">Protein Weight (g):</label>
      <input type="number" class="form-control" id="protein-weight" value="150">
    </div>

    <div class="mb-3 col-6 col-lg-3">
      <label for="fat" class="form-label">Fat (g) for 150g:</label>
      <input type="number" class="form-control" id="fat" value="">
    </div>

    <div class="mb-3 col-6 col-lg-3">
      <label for="fat-weight" class="form-label">Fat Weight (g):</label>
      <input type="number" class="form-control" id="fat-weight" value="150">
    </div>

    <div class="mb-3 col-12 col-lg-3">
      <label for="meal-name" class="form-label">Meal Name:</label>
      <input type="text" class="form-control" id="meal-name" placeholder="Enter meal name">
    </div>

    <div class="text-center">
        <button type="button" class="btn btn-primary" onclick="addMeal()">Add Meal</button>
    </div>
  </form>

  <!-- Calculated Nutrition Section -->
  <div class="mt-4">
    <h3>Calculated Nutrition (Total for All Meals):</h3>
    <p id="calculated-carbs">Carbs: 0g</p>
    <p id="calculated-protein">Protein: 0g</p>
    <p id="calculated-fat">Fat: 0g</p>

    <h3>Total Calories: </h3>
    <p id="total-calories">Total Calories: 0 kcal</p>
  </div>

  <!-- Meals List -->
  <div class="mt-4">
    <h3>Meals Added:</h3>
    <ul id="meal-list" class="list-group mb-3">
      <!-- Meals will be listed here -->
    </ul>

    <button onclick="deleteAllMeals()" class="btn btn-danger">Delete All Meals</button>
  </div>
</div>

<!-- Bootstrap JS and dependencies -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" ></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" ></script>

<script>
  // Default values for 150g
  const selectedNutrition = {
    carbs: 50,
    protein: 30,
    fat: 50
  };

  // Function to update the nutrition values based on input
  function updateNutrition() {
    const carbsWeight = parseFloat(document.getElementById('carbs-weight').value);
    const proteinWeight = parseFloat(document.getElementById('protein-weight').value);
    const fatWeight = parseFloat(document.getElementById('fat-weight').value);

    selectedNutrition.carbs = parseFloat(document.getElementById("carbs").value);
    selectedNutrition.protein = parseFloat(document.getElementById("protein").value);
    selectedNutrition.fat = parseFloat(document.getElementById("fat").value);

    // Calculate new values based on entered weight for each macronutrient
    const carbs = (carbsWeight / 150) * selectedNutrition.carbs;
    const protein = (proteinWeight / 150) * selectedNutrition.protein;
    const fat = (fatWeight / 150) * selectedNutrition.fat;

    // Update the displayed individual nutrition values for the current input
    document.getElementById('calculated-carbs').textContent = `Carbs: ${carbs.toFixed(2)}g`;
    document.getElementById('calculated-protein').textContent = `Protein: ${protein.toFixed(2)}g`;
    document.getElementById('calculated-fat').textContent = `Fat: ${fat.toFixed(2)}g`;
  }

  // Function to add the current meal to local storage and display the meals list
  function addMeal() {
    const mealName = document.getElementById('meal-name').value;
    if (mealName === "") {
      alert("Please enter a meal name.");
      return;
    }

    const carbsWeight = parseFloat(document.getElementById('carbs-weight').value);
    const proteinWeight = parseFloat(document.getElementById('protein-weight').value);
    const fatWeight = parseFloat(document.getElementById('fat-weight').value);

    selectedNutrition.carbs = parseFloat(document.getElementById("carbs").value);
    selectedNutrition.protein = parseFloat(document.getElementById("protein").value);
    selectedNutrition.fat = parseFloat(document.getElementById("fat").value);

    const meal = {
      name: mealName,
      carbs: (carbsWeight / 150) * selectedNutrition.carbs,
      protein: (proteinWeight / 150) * selectedNutrition.protein,
      fat: (fatWeight / 150) * selectedNutrition.fat
    };

    // Get existing meals from local storage
    let meals = JSON.parse(localStorage.getItem('meals')) || [];
    meals.push(meal);

    // Save the updated meals back to local storage
    localStorage.setItem('meals', JSON.stringify(meals));

    // Update the meal list display
    displayMeals();
  }

  // Function to display the list of meals added and recalculate the total nutrition
  function displayMeals() {
    const mealList = document.getElementById('meal-list');
    mealList.innerHTML = "";

    // Get meals from local storage
    const meals = JSON.parse(localStorage.getItem('meals')) || [];
    let totalCalories = 0;
    let totalCarbs = 0;
    let totalProtein = 0;
    let totalFat = 0;

    meals.forEach((meal, index) => {
      const listItem = document.createElement('li');
      listItem.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center');
      listItem.textContent = `${meal.name} - Carbs: ${meal.carbs.toFixed(2)}g, Protein: ${meal.protein.toFixed(2)}g, Fat: ${meal.fat.toFixed(2)}g`;

      // Create delete button for each meal
      const deleteButton = document.createElement('button');
      deleteButton.classList.add('btn', 'btn-danger', 'btn-sm');
      deleteButton.textContent = 'Delete';
      deleteButton.onclick = () => deleteMeal(index);

      listItem.appendChild(deleteButton);
      mealList.appendChild(listItem);

      // Calculate total calories (4 calories per g of carbs and protein, 9 calories per g of fat)
      totalCarbs += meal.carbs;
      totalProtein += meal.protein;
      totalFat += meal.fat;
      totalCalories += (meal.carbs * 4) + (meal.protein * 4) + (meal.fat * 9);
    });

    // Update the total nutrition and calories display
    document.getElementById('calculated-carbs').textContent = `Carbs: ${totalCarbs.toFixed(2)}g`;
    document.getElementById('calculated-protein').textContent = `Protein: ${totalProtein.toFixed(2)}g`;
    document.getElementById('calculated-fat').textContent = `Fat: ${totalFat.toFixed(2)}g`;
    document.getElementById('total-calories').textContent = `Total Calories: ${totalCalories} kcal`;
  }

  // Function to delete a single meal from local storage
  function deleteMeal(index) {
    let meals = JSON.parse(localStorage.getItem('meals')) || [];
    meals.splice(index, 1); // Remove the meal at the specified index

    // Save the updated meals list to local storage
    localStorage.setItem('meals', JSON.stringify(meals));

    // Update the meal list display
    displayMeals();
  }

  // Function to delete all meals from local storage
  function deleteAllMeals() {
    localStorage.removeItem('meals');
    displayMeals();
  }

  // Listen for changes in the form and update nutrition in real-time
  document.getElementById('nutrition-form').addEventListener('input', updateNutrition);

  // Initialize the page with stored meals (if any)
  window.onload = function() {
    displayMeals(); // Recalculate nutrition when page loads
  };

  // Initialize nutrition calculation for a new meal form
  updateNutrition();
</script>

</body>
</html>
